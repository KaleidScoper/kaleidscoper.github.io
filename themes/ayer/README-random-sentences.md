# 随机句子功能使用说明

## 功能描述
在页面底部版权信息、访问量统计等信息的下方，显示一个随机选择的中文句子。每次页面刷新或重新访问时，都会从句子库中随机选择一个新的句子显示。

## 配置方法

### 1. 在 `_config.ayer.yml` 中启用功能
```yaml
# 随机句子模块
random_sentences:
  enable: true # true开启，false关闭
  use_local_file: true # true使用本地txt文件，false使用内置句子库
  queue_size: 5 # 防重复队列大小，存储最近显示的句子数量
```

**配置说明：**
- `enable`: 控制整个随机句子功能的开启/关闭
- `use_local_file`: 控制句子来源
  - `true`: 从 `themes/ayer/source/data/random-sentences.txt` 文件读取句子
  - `false`: 使用内置的默认句子库
- `queue_size`: 防重复队列大小（默认5）
  - 设置最近显示句子的存储数量
  - 脚本会避免重复显示队列中的句子
  - 建议设置为句子库总数的1/4到1/3

### 2. 自定义句子库
编辑 `themes/ayer/source/data/random-sentences.txt` 文件，每行添加一个句子。

**格式说明：**
- 每行一个句子
- 单空格：保持为空格显示
- 双空格及以上：自动转换为换行符
- **空行会被自动过滤**：txt文件中的空行不会被当作句子
- **支持注释**：以 `#` 开头的行会被忽略，可用于添加说明或分类标记

**示例：**
```
# 这是一条注释，不会被显示

# 励志类
这是第一句话
这是第二句话  这里有两个空格，会换行

# 古诗词类
这是第三句话

# 上面的空行和注释行都会被过滤掉
```

## 功能特点

1. **随机选择**：每次页面加载时随机选择句子
2. **防重复显示**：使用队列机制避免重复显示最近展示过的句子
3. **智能换行**：支持通过空格数量控制换行（双空格及以上转为换行）
4. **自动过滤**：读取txt文件时自动忽略空行和以 `#` 开头的注释行
5. **注释支持**：可在txt文件中用 `#` 添加注释和分类说明
6. **降级处理**：txt文件读取失败时自动使用内置默认句子库
7. **响应式设计**：适配不同屏幕尺寸
8. **可配置**：可以通过配置文件轻松开启/关闭和调整参数
9. **性能优化**：只在功能启用时加载相关资源
10. **页面可见性响应**：页面从隐藏恢复时自动更换新句子

## 文件结构

```
themes/ayer/
├── source/
│   ├── data/
│   │   └── random-sentences.txt    # 句子库文件
│   ├── js/
│   │   └── random-sentences.js     # 功能逻辑文件
│   └── css/
│       └── custom.styl             # 样式文件
├── layout/
│   └── _partial/
│       ├── footer.ejs              # 底部布局文件
│       └── head.ejs                # 头部布局文件
└── _config.ayer.yml                # 主题配置文件
```

## 自定义样式

可以通过修改 `themes/ayer/source/css/custom.styl` 文件中的 `.random-sentence` 样式来自定义显示效果。

## 防重复算法说明

### 工作原理
1. **队列管理**：维护一个固定大小的队列存储最近显示的句子
2. **智能选择**：优先从不在队列中的句子中随机选择
3. **队列更新**：每次显示新句子后，将其加入队列末尾
4. **自动清理**：队列满时自动移除最旧的句子
5. **兜底机制**：当所有句子都在队列中时，清空队列重新开始

### 配置建议
- **小句子库**（<20句）：设置 `queue_size: 3-5`
- **中等句子库**（20-50句）：设置 `queue_size: 5-10`  
- **大句子库**（>50句）：设置 `queue_size: 10-15`

## 注意事项

1. 确保句子库文件使用UTF-8编码
2. 句子不要太长，建议每行不超过50个字符
3. 功能启用后，每次页面刷新都会重新选择句子
4. 如果不需要此功能，可以在配置文件中设置 `enable: false`
5. 队列大小建议不超过句子库总数的1/3，以确保有足够的句子可供选择
6. **空行会被自动过滤**，可以在txt文件中用空行分隔不同类型的句子以便编辑
7. **支持注释**，使用 `#` 开头的行添加注释，方便分类和说明（注释行会被忽略，不会作为句子显示）
8. 注释符 `#` 必须在行首（去除空格后），行中间的 `#` 不会被识别为注释
